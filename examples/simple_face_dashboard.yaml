# Simple WhoRang Face Management Dashboard
# Uses only standard Home Assistant cards - no custom components required

title: WhoRang Face Recognition (Simple)
path: whorang-face-simple
icon: mdi:face-recognition
theme: default

views:
  - title: Face Manager
    path: face-manager
    icon: mdi:face-recognition
    cards:
      # System Status
      - type: entities
        title: System Status
        show_header_toggle: false
        entities:
          - entity: binary_sensor.whorang_ai_doorbell_system_online
            name: System Online
            icon: mdi:server-network
            
          - entity: sensor.whorang_ai_doorbell_ai_provider
            name: AI Provider
            icon: mdi:brain
              
          - entity: binary_sensor.whorang_ai_doorbell_ai_processing
            name: AI Processing
            icon: mdi:cog

      # Face Gallery Information
      - type: entities
        title: Face Gallery Status
        show_header_toggle: false
        entities:
          - entity: sensor.whorang_ai_doorbell_face_gallery
            name: Face Gallery
            icon: mdi:face-recognition
            
          - type: attribute
            entity: sensor.whorang_ai_doorbell_face_gallery
            attribute: total_unknown
            name: Unknown Faces
            icon: mdi:help-circle
            
          - type: attribute
            entity: sensor.whorang_ai_doorbell_face_gallery
            attribute: total_known
            name: Known People
            icon: mdi:account-group
            
          - type: attribute
            entity: sensor.whorang_ai_doorbell_face_gallery
            attribute: labeling_progress
            name: Progress (%)
            icon: mdi:progress-check

      # Face Labeling Controls
      - type: entities
        title: Face Labeling
        show_header_toggle: false
        entities:
          - input_number.face_id_input
          - input_text.person_name_input
          - type: button
            name: Label Face
            icon: mdi:tag
            action_name: Label
            tap_action:
              action: call-service
              service: whorang.label_face
              service_data:
                face_id: "{{ states('input_number.face_id_input') | int }}"
                person_name: "{{ states('input_text.person_name_input') }}"

      # Batch Labeling
      - type: entities
        title: Batch Labeling
        show_header_toggle: false
        entities:
          - input_text.batch_person_name
          - type: button
            name: Label All Unknown as Same Person
            icon: mdi:tag-multiple
            action_name: Batch Label
            tap_action:
              action: call-service
              service: whorang.batch_label_faces
              service_data:
                face_ids: >
                  {% set faces = state_attr('sensor.whorang_ai_doorbell_face_gallery', 'unknown_faces') %}
                  {% if faces %}
                    {{ faces | map(attribute='id') | list }}
                  {% else %}
                    []
                  {% endif %}
                person_name: "{{ states('input_text.batch_person_name') }}"
                create_person: true

      # Quick Actions
      - type: entities
        title: Quick Actions
        show_header_toggle: false
        entities:
          - type: button
            name: Refresh Face Gallery
            icon: mdi:refresh
            action_name: Refresh
            tap_action:
              action: call-service
              service: homeassistant.update_entity
              service_data:
                entity_id: sensor.whorang_ai_doorbell_face_gallery
                
          - type: button
            name: Get Unknown Faces
            icon: mdi:face-recognition
            action_name: Scan
            tap_action:
              action: call-service
              service: whorang.get_unknown_faces
              service_data:
                limit: 50
                quality_threshold: 0.3
                
          - type: button
            name: Trigger Analysis
            icon: mdi:brain
            action_name: Analyze
            tap_action:
              action: call-service
              service: whorang.trigger_analysis

      # Face Gallery Data (Raw)
      - type: entities
        title: Unknown Faces (Raw Data)
        show_header_toggle: false
        entities:
          - type: attribute
            entity: sensor.whorang_ai_doorbell_face_gallery
            attribute: unknown_faces
            name: Unknown Faces List
            icon: mdi:format-list-bulleted

      # Instructions
      - type: markdown
        content: |
          ## How to Use Face Labeling
          
          ### Individual Face Labeling
          1. **Check "Unknown Faces List"** above to see face IDs
          2. **Enter Face ID** in the number input
          3. **Enter Person Name** in the text input
          4. **Click "Label Face"** to assign the face
          
          ### Batch Labeling
          1. **Enter Person Name** in "Batch Person Name"
          2. **Click "Label All Unknown as Same Person"**
          3. **All unknown faces** will be labeled with that name
          
          ### Tips
          - Use "Refresh Face Gallery" to update the data
          - Use "Get Unknown Faces" to scan for new faces
          - Check the "Face Gallery Status" for progress
          
          ### Face Image URLs
          Face images can be accessed at:
          - **Full image**: `http://whorang:8080/api/faces/{face_id}/image`
          - **Thumbnail**: `http://whorang:8080/api/faces/{face_id}/image?size=thumbnail`
          
          Replace `{face_id}` with the actual face ID from the list above.
          
          ### Note
          This is a simplified dashboard using only standard Home Assistant cards.
          The visual face manager card is being developed and will provide a 
          Google Nest-style interface with clickable face thumbnails.
